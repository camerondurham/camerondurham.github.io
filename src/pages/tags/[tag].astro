---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  const tags = [...new Set(posts.flatMap(post => post.data.tags))];
  
  return tags.map(tag => ({
    params: { tag },
    props: { 
      posts: posts
        .filter(post => post.data.tags.includes(tag))
        .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
    }
  }));
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout title={`Posts tagged "${tag}" | Cameron Durham`}>
  <h1>Posts tagged "{tag}"</h1>
  <div class="posts-list">
    {posts.map(post => (
      <article class="post-item">
        <h2><a href={`/posts/${post.slug}`}>{post.data.title}</a></h2>
        <time datetime={post.data.date}>{post.data.date}</time>
        {post.data.summary && <p>{post.data.summary}</p>}
      </article>
    ))}
  </div>
  <a href="/tags" class="back-link">‚Üê All tags</a>
</BaseLayout>

<style>
.posts-list { display: flex; flex-direction: column; gap: 2rem; padding-top: 1rem; }
.post-item { border-bottom: 1px solid var(--border-color); padding-bottom: 2rem; }
.post-item:last-child { border-bottom: none; }
.post-item h2 { margin-bottom: 0.5rem; }
.post-item h2::before { content: none; }
.post-item time { display: block; margin-bottom: 0.5rem; }
.back-link { display: inline-block; margin-top: 2rem; }
</style>
